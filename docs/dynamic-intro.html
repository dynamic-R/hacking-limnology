<!DOCTYPE html>
<html lang="en" xml:lang="en">
  <head>
    <title>Numerical simulation of dynamic systems with R: an introduction</title>
    <meta charset="utf-8" />
    <meta name="author" content="Thomas Petzoldt and Karline Soetaert" />
    <meta name="date" content="2021-06-12" />
    <script src="libs/header-attrs-2.8.4/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/useR-fonts.css" rel="stylesheet" />
    <script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
    <script src="libs/viz-1.8.2/viz.js"></script>
    <link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
    <script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>
    <link rel="stylesheet" href="tp_xaringan_scrollable.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">


class: center, middle, title-slide

background-image: url("img/water-light.jpg")

&lt;!-- Own title slide / --&gt;

# Numerical simulation of dynamic systems with R: an introduction

## Thomas Petzoldt and Karline Soetaert


### IMPORTANT NOTE

This slide set is work in progress and still at a **very early stage of development**.
It works with **Chrome** and recent versions of **Edge**, wheres scrolling may have problems with Firefox.

The name of the repo points to an upcoming workshop about open data in aquatic sciences https://aquaticdatasciopensci.github.io/ in July 2021

For the time being, please consult https://desolve-r-forge.r-project.org

### 2021-06-12



&lt;!-- citations work differently with xaringan compared to @Markdown / --&gt;


---


## Preface



Dynamical systems are found everywhere, in mathematics, physics, chemistry, engineering and business - ecology and aquatic sciences are no exception.

One common approach to describe such systems is by means of differential equations. Following the ideas of Forrester, differential equations appear quite naturally if we describe changes in a system in terms of growth and decay, which together make up a mass balance. A somewhat bigger challenge is to solve these differential equations - some of us may still remember the challenges of differential calculus in high school courses.

Fortunately, computer algorithms allow to solve even complex differential equation systems numerically. This has opened a world of practical applications to be accessible for anyone that has a basic knowledge in scientific computing, or is willing to acquire this knowledge. R is such a scientific computing language that offers powerful methods to solve differential equations. Moreover, some R-packages are especially designed to also solve spatially variable problems that are often found of importance in aquatic sciences.

The introduction will demonstrate selected examples: growth of organisms, predator-prey interaction, spread of diseases, and transport-reaction problems. The formulation of such models in R can be surprisingly compact and close to the mathematical equations. 

---


## Dynamical System


* In mathematics, a system in which a function describes the time dependence of a point in a geometrical space.
* Examples include models that describe the swinging of a clock pendulum, the flow of water in a pipe, and the number of fish each springtime in a lake.
* The state of a dynamical system at a given time is a vector of real numbers, a point in state space. 
* The evolution rule is a function that describes what future states follow from the current state.&lt;sup&gt;[1]&lt;/sup&gt;


### Different ways of description

* statistical approach: time series of state variables (pools)
* dynamic approach: description of changes
    * automata in discrete time: IBMs, ABMs, cellular automata
    * equations in discrete time: difference equations
    * equations in continuous time: differential equations (ODEs)

A dynamical system can be described deterministically or stochastically. 

We focus on the **deterministic** description in **continuous** time
with numerically solved differential equations.

[1] Wikipedia, [Dynamical_system](https://en.wikipedia.org/wiki/Dynamical_system)
---

class: scrollable-slide

## Differential Calculus

.pull-left[

`\(\dot{y} = k \cdot y\)`

![:scale 50%](img/newton.jpg)

Isaac Newton, 1643 - 1727
]

.pull-right[

`\(\frac{dy}{dx} = k \cdot y\)`

![:scale 55%](img/leibniz.jpg)

Gottfried Wilhelm Leibniz, 1646 - 1716


]

---

## Jay W. Forrester: System Dynamics


.pull-left[


![:scale 70%](img/forrester-fig3.png)
]



.pull-right[


![:scale 50%](img/forrester-fig4.png)
]

* thinking in feedback loops
* easy to understand, if we think in pools and changes

From: [Forrester, J.W. (2009) Some Basic Concepts in System Dynamics](https://www.cc.gatech.edu/classes/AY2018/cs8803cc_spring/research_papers/Forrester-SystemDynamics.pdf)

---

## Dynamic systems: how and why?


"Many believe that system dynamics has helped them become skilled at
inventing the future, either by sketching out causal loops on the back of
an envelope, or by assembling equations of cause and effect in a
computer model. Both approaches work." (J.W.F, 1995)


.pull-left[
#### Letâ€™s speak about computers
- continous time `\(\rightarrow\)` differential equations
- discrete time: another interesting story ...

.center[
![:scale 40%](img/rlogo.png)
]
]    

.pull-right[
#### Why numerical integration?
* Not all systems have an analytical solution.
* Numerical solutions allow discrete input.    

"... students can deal with high-order dynamic systems
without ever discovering that their elders consider such to be very difficult."
J.W. Forrester 2009.
]


---

## Import and Export

`$${
\frac{dX}{dt} = \mbox{import} - \mbox{export}\\
}$$`

<div id="htmlwidget-6bed5b210349ff2adec5" style="width:864px;height:288px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-6bed5b210349ff2adec5">{"x":{"diagram":"digraph feedback {\n         graph [rankdir = \"LR\"]\n           node [shape = box, penwidth=2, fontname = \"Helvetica\"]\n             Matter\n           node [shape = octagon, penwidth=0.5, style=\"rounded\", fixedsize=25, fontsize=8]\n             Source Sink\n           node [shape = none, fontsize=10]\n             import export\n           edge [penwidth=1.5]\n             Source -> import -> Matter -> export -> Sink\n         \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>



---

## Exponential Growth

`$${\frac{dN}{dt} = \mbox{birth} - \mbox{death}\\
\frac{dN}{dt} = \mbox{birthhrate} \cdot N - \mbox{deathrate}\cdot N\\
\frac{dN}{dt} = b \cdot N - d \cdot N = (b-d) \cdot N = r \cdot N\\
}$$`
<div id="htmlwidget-c2e76d4d8875b791cf95" style="width:1008px;height:288px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-c2e76d4d8875b791cf95">{"x":{"diagram":"digraph feedback {\n         graph [rankdir = \"LR\"]\n           node [shape = box, penwidth=2, fontname = \"Helvetica\"]\n             Population\n           node [shape = octagon, penwidth=0.5, style=\"rounded\", fixedsize=25, fontsize=8]\n             Source Sink\n           node [shape = none, fontsize=10]\n             birth death\n           edge [penwidth=1.5]\n             Source -> birth -> Population -> death -> Sink\n           edge [penwidth=0.7, tailport = \"n\", headport = \"n\", constraint = false, color=tomato]\n             Population -> birth \n             Population -> death\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>


---

## Analytical Integration and the Euler Method

Integration can be done analytically or with the computer


.pull-left[
![](dynamic-intro_files/figure-html/unnamed-chunk-3-1.png)&lt;!-- --&gt;
```r
r    &lt;- 0.5
N0   &lt;- 10
dt   &lt;- 0.1
time &lt;- seq(0, 10, dt)

N &lt;- N0 * exp(r * time)
plot(time, N, type="l")
```
]

.pull-right[
`$${
\frac{dN}{dt} = r\cdot N\\
\int_0^t \frac{dN}{dt} = \int_0^t r\cdot N\\
\int_0^t \frac{1}{N} dN = \int_0^t r dt\\
\ln(N)=rt + c\\
N_t = N_0 e^{rt}\\
}$$`
]

---

## Numerical Integration and the Euler Method


.pull-left[

![](dynamic-intro_files/figure-html/unnamed-chunk-4-1.png)&lt;!-- --&gt;



```r
N &lt;- numeric(length(time))

N[1] &lt;- N0
for (i in 2:length(time)) {
  N[i] &lt;- N[i-1] + r * N[i-1] * dt
}
plot(time, N, type = "l")
```
]

.pull-right[
`$${
\frac{dN}{dt} = r\cdot N\\
\frac{\Delta N}{\Delta t} = r\cdot N\\
N_t = N_{t-1} + r\cdot N_{t-1}
}$$`
]

---

### Numerical Integration with deSolve: the Simple Way

.pull-left[
#### Logistic growth

`\(\frac{dN}{dt} = rN(1-N/K)\)`

#### Model formulation close to mathematical notation


```r
library("deSolve")
model &lt;- function (time, y, parms) {
  with(as.list(c(y, parms)), {
*  dN &lt;- r * N * (1 - N / K)
    list(c(dN))
  })
}
y0 &lt;- c(N = 0.1)
parms &lt;- c(r = 0.1, K = 10)
times &lt;- seq(0, 100, 1)
```
]

.pull-right[
#### Solve with `ode`


```r
out &lt;- ode(y0, times, model, parms)
```

#### Plot


```r
plot(out)
```


![](dynamic-intro_files/figure-html/ode-naive2-1.png)&lt;!-- --&gt;
]

---
## What is deSolve?

.pull-left[ 

#### An **R package** to solve differential equations

* numerical simulation of **initial value problems**
* ODE, PDE, DAE, DDE
* popular *industry class solvers* from ODEPACK `\(^1\)`
* `+` classical Euler and Runge-Kutta solvers
* convenience tools (e.g. `plot`, forcings, events) 
* extensive documentation, e.g.
  ([Soetaert, Petzoldt, and Setzer, 2010b](http://www.jstatsoft.org/v33/i09))
]

.pull-right[

#### Part of an "Ecosystem" for dynamical simulations
* packages: rootSolve, bvpSolve, FME, reacTran, ...
* books, websites, [StackOverflow]()

#### More:
* See [CRAN Task View](https://cran.r-project.org/web/views/DifferentialEquations.html) for related packages
]

`\(^1\)` Thanks to the great authors (ctb=contributors) of the original algorithms who made their code publicly available:

Peter N. Brown [ctb] (files ddaspk.f, dvode.f, zvode.f), George D. Byrne [ctb] (files dvode.f, zvode.f), Ernst Hairer [ctb] (files radau5.f, radau5a), Alan C. Hindmarsh [ctb] (files ddaspk.f, dlsode.f, dvode.f, zvode.f, opdkmain.f, opdka1.f), Cleve Moler [ctb] (file dlinpck.f), Linda R. Petzold [ctb] (files ddaspk.f, dlsoda.f), Youcef Saad [ctb] (file dsparsk.f), Clement W. Ulrich [ctb] (file ddaspk.f)

---
## What is `ode`?

#### `ode`
* top-level function to call one of the solvers
* default: `lsoda`
* Livermore solver for Ordinary Differential Equations, automatic

#### `lsoda`, `adams`, `bdf`, `vode`, ...?

* stiff systems: `bdf`: tries hard to solve the system
* sometimes, `adams` may be faster for simple problems 
* default `lsoda` switches automatically between `bdf`and `adams`

#### `euler`, `rk4`, `ode45`, ...

* for specific problems

#### `ode.1D`, `ode.3d`, ... `dde` 

* see docs


---
## Automatic Step Size

.pull-left[
#### External and internal step size

* user specifies tolerances `atol`, `rtol` = 1e-6
* solver **adapts** internal step size to meet precision
* results returned at pre-specified **external** time points


#### Fixed-step solvers

* `euler`, `rk2`, `rk4`
* problem: either not precise enough or too much work
    * danger of instability
    * optimum time step can vary over time
    * stiff systems: some states change faster than others
* `rk4` was very popular, as it is very easy to implement
* use only if you know why 

]

.pull-right[

```r
out &lt;- ode(y0, 
*  times = 1:10, # external time steps
  model, 
  parms, 
  atol = 1e-6, # absolute tolerance
  rtol = 1e-6  # relative tolerance
)
```
]


---
## Resource Limited Growth

#### Two state variables

* Nutrients, Algae
* feedback
* functional response (e.g. Holling, Monod, ...)




<div id="htmlwidget-f03813c5a27e49a739e6" style="width:1008px;height:216px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-f03813c5a27e49a739e6">{"x":{"diagram":"digraph feedback {\n         graph [rankdir = \"LR\"]\n           node [shape = box, penwidth=2, fontname = \"Helvetica\"]\n             Nutrient, Algae\n           node [shape = none, fontsize=10]\n             growth\n           edge [penwidth=1.5]\n             Nutrient -> growth -> Algae \n           edge [penwidth=0.7, tailport = \"n\", headport = \"n\", constraint = false, color=tomato]\n             Algae -> growth \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>


---


## System of equations

<div id="htmlwidget-6e1a68f06cd2210c8db8" style="width:1008px;height:216px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-6e1a68f06cd2210c8db8">{"x":{"diagram":"digraph feedback {\n         graph [rankdir = \"LR\"]\n           node [shape = box, penwidth=2, fontname = \"Helvetica\"]\n             Nutrient, Algae\n           node [shape = none, fontsize=10]\n             growth\n           edge [penwidth=1.5]\n             Nutrient -> growth -> Algae \n           edge [penwidth=0.7, tailport = \"n\", headport = \"n\", constraint = false, color=tomato]\n             Algae -> growth \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

$$
\frac{d\mbox{Algae}}{dt} = r \cdot f(\mbox{Nutrients}) \cdot \mbox{Algae}
$$
$$
\frac{d\mbox{Nutrients}}{dt} = - \frac{1}{Yield} \cdot r \cdot f(\mbox{Nutrients}) \cdot  \mbox{Algae} 
$$



---

## Resource Limited Growth

#### The Model


```r
model &lt;- function (time, y, parms) {
  with(as.list(c(y, parms)), {
    f &lt;- P/(kP + P)
    dAlg &lt;- r * f * Alg
    dP   &lt;- - r * 1/Y * f * Alg
    list(c(dAlg, dP))
  })
}
y &lt;- c(Alg = 0.1, P = 0.2) # in mg/L
parms &lt;- c(r = 0.1, kP = 5e-3, Y = 41) # Y = C:P mass ratio
```

#### Where do parameters come from?

* `\(r\)`, `\(k_P\)` derived from lab experiments
* `\(Y\)` first guess from stoichiometry


```r
library("marelac")
redfield(1, species="P", method="mass")
```

```
##          C        H        O        N P
## 1 41.10363 8.558477 56.82016 7.235388 1
```

#### Simulate Model


```r
out &lt;- ode(y, times, model, parms)
plot(out)
```

![](dynamic-intro_files/figure-html/unnamed-chunk-9-1.png)&lt;!-- --&gt;

#### Compare Scenarios


```r
out1 &lt;- ode(y, times, model, parms =  c(r = 0.2, kP = 5e-3, Y = 41))
out2 &lt;- ode(y, times, model, parms =  c(r = 0.1, kP = 1e-2, Y = 50))

plot(out1, out2)
legend("topright", legend=c("Scenario 1", "Scenario 2"), lty=1:2, col=1:2)
```

![](dynamic-intro_files/figure-html/unnamed-chunk-10-1.png)&lt;!-- --&gt;



---

## SIR and the Covid 19 Pandemic


* similar to resource-limited growth
* show atol, rtol and rescaling of problems

---

## External Interventions


* implementation of forcings
* plotting of scenarios

---

## Back to Lake Modelling: The Chemostat


* inflow and outflow
* numerical solution
* equilibrium
* rootSolve and analytical solution of equlibrium

---

## The Chemostat Code



```r
library("deSolve")
library("rootSolve")

chemostat &lt;- function(time, init, parms) {
  with(as.list(c(init, parms)), {
    mu   &lt;- mumax * P/(kp + P)  # Monod equation
    dAlg &lt;- mu * Alg - D * Alg
    dP   &lt;-  D *(P0 - P) - 1/Y * mu * Alg
    list(c(dAlg, dP), mu=mu)
   })
}
parms &lt;- c(
  mumax = 0.5,    # 1/d
  kp    = 0.01,   # half saturation constant (mg/L)
  Y     = 41,     # yield coefficient (stoichiometric C:P ratio)
  D     = 0.1,    # 1/d
  P0    = 0.05    # P in inflow (mg/L)
)
times &lt;- seq(0, 40, 0.1)  # (d)
init  &lt;- c(Alg=0.01, P=0.05) # Phytoplankton C and Phosphorus P (mg/L)

## =============================================================================
## Dynamic simulation
## =============================================================================
out &lt;- ode(init, times, chemostat, parms)
plot(out)

## =============================================================================
## Steady state solution
## =============================================================================
state &lt;- data.frame(
  D = seq(0, 0.6, length.out = 100),
  X = 0,
  S = 0
)

for (i in 1:nrow(state)) {
  parms["D"] &lt;- state$D[i]
  times &lt;- c(0, Inf)
  out &lt;- runsteady(init, times, chemostat, parms)
  state[i, 2:3] &lt;- out$y
}

par(mfrow = c(3, 1))
```

![](dynamic-intro_files/figure-html/unnamed-chunk-11-1.png)&lt;!-- --&gt;

```r
plot(S ~ D, data = state, type = "l")
plot(X ~ D, data = state, type = "l")
plot(S * X ~ D, data = state, type = "l")
```

![](dynamic-intro_files/figure-html/unnamed-chunk-11-2.png)&lt;!-- --&gt;


---

## Interaction Between Populations

### Lotka-Volterra's Predator and Prey

<div id="htmlwidget-c31d7fabbf2122b90820" style="width:1008px;height:288px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-c31d7fabbf2122b90820">{"x":{"diagram":"digraph lotka {\n         graph [rankdir = \"LR\"]\n           node [shape = box, penwidth=2, fontname = \"Helvetica\"]\n             Predator, Prey\n           node [shape = octagon, penwidth=0.5, style=\"rounded\", fixedsize=25, fontsize=8]\n             Source Sink\n           node [shape = none, fontsize=10]\n             growth death grazing\n           edge [penwidth=1.5]\n             Source -> growth -> Prey -> grazing -> Predator -> death -> Sink\n           edge [penwidth=0.7, tailport = \"n\", headport = \"n\", constraint = false, color=tomato]\n             Prey -> growth\n             Predator -> grazing\n           edge [penwidth=0.7, tailport = \"s\", headport = \"s\", constraint = false, color=tomato]\n             Prey -> grazing\n             Predator -> death\n\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

* state diagram, cycles
* damped cycle if we introduce a Monod term




---

## Lotka Voltera Model

<div id="htmlwidget-e5cc4f308e3454b023f9" style="width:1008px;height:288px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-e5cc4f308e3454b023f9">{"x":{"diagram":"digraph lotka {\n         graph [rankdir = \"LR\"]\n           node [shape = box, penwidth=2, fontname = \"Helvetica\"]\n             Predator, Prey\n           node [shape = octagon, penwidth=0.5, style=\"rounded\", fixedsize=25, fontsize=8]\n             Source Sink\n           node [shape = none, fontsize=10]\n             growth death grazing\n           edge [penwidth=1.5]\n             Source -> growth -> Prey -> grazing -> Predator -> death -> Sink\n           edge [penwidth=0.7, tailport = \"n\", headport = \"n\", constraint = false, color=tomato]\n             Prey -> growth\n             Predator -> grazing\n           edge [penwidth=0.7, tailport = \"s\", headport = \"s\", constraint = false, color=tomato]\n             Prey -> grazing\n             Predator -> death\n\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>


`$$\frac{dX}{dt} = \mbox{Growth} - \mbox{Grazing} \qquad \mbox{(Prey)}$$` 

`$$\frac{dY}{dt} = g \cdot \mbox{Grazing} - \mbox{Mortality}  \qquad \mbox{(Predator)}$$`
#### With:

* `\(\mbox{Growth} \qquad = a \cdot X\)` &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; (exponential growth)
* `\(\mbox{Mortalily} \ \quad = -e \cdot Y\)` &amp;nbsp;&amp;nbsp; (exponential decay)
* `\(\mbox{Grazing} \qquad= b \cdot X \cdot Y\)` &amp;nbsp;&amp;nbsp; (interaction)

---
&lt;style type="text/css"&gt;
.remark-slide-number {
    display: none;
}
&lt;/style&gt;

## Lotka-Volterra Model

### Implementation


```r
require(deSolve)   
y0      &lt;- c(X=300, Y=10)            # state variable initial conditions
parms   &lt;- c(a=0.05, K=500, b=0.0002, g=0.8, e=0.03)  # parameter values

LV &lt;- function(t, state, parameters) { 
  with (as.list(c(state, parameters)), {
    Growth     &lt;- a*X
    Grazing    &lt;- b*X*Y
    Mortality  &lt;- e*Y
    dXdt &lt;- Growth - Grazing
    dYdt &lt;- g * Grazing - Mortality
    return (list(c(dXdt, dYdt),  # vector of derivatives
                 sum = X+Y))     # output variable
  })
}
times &lt;- 1:1000
out   &lt;- ode(y = y0, func = LV, times = times, parms = parms)
plot(out, mfrow = c(1, 3), cex.axis=1.4, cex.lab=1.4, las=1)
```

![](dynamic-intro_files/figure-html/unnamed-chunk-13-1.png)&lt;!-- --&gt;

---

## Efficient Model Formulation in Matrix Style


* multi-species predator-prey model

---

## PDE's in 1D: Transport in a River


* package ReacTran
* uses also matrix formulation
* plot3D example

---

## Outlook


* some bigger applications
* rodeo package
* shiny

---

## Appendices


Things that should be mentioned somewhere, but not yet in the introductory
lecture

* Solver functions in deSolve
* C and Fortran interface
* Karline's books
* Online resources: R-Forge, CRAN-Taskview, publications



---

## Copyright


This resource was created by [tpetzoldt](github.com/tpetzoldt) and 
[karlines](https://github.com/karlines). It is provided 
as is without warranty.

---

## Bibliography


&lt;a name=bib-deSolve_jss&gt;&lt;/a&gt;[Soetaert, K., T. Petzoldt, and R. Setzer](#cite-deSolve_jss)
(2010b). "Solving Differential Equations in R: Package 'deSolve'". In: _Journal of
Statistical Software_ 33.9, pp. 1-25. ISSN: 1548-7660. URL:
[http://www.jstatsoft.org/v33/i09](http://www.jstatsoft.org/v33/i09).

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="tp_xaringan.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"self_contained": false,
"navigation": {
"scroll": false
}
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
